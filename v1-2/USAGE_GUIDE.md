# Руководство по использованию WoodWOP Post Processor

## Быстрый старт

### 1. Создание проекта в FreeCAD

1. Откройте FreeCAD
2. Переключитесь в **CAM (Path) Workbench**
3. Создайте **Job** (Задание):
   - Path → Job → New Job
   - Выберите базовый объект (деталь)
   - Настройте Stock (заготовку) - размеры будут автоматически использованы в MPR

### 2. Создание операций

Поддерживаемые операции:

#### Profile (Контурное фрезерование)
- Path → Profile
- Выберите грани или эскиз
- Назначьте инструмент
- В MPR преобразуется в → **Contourfraesen**

#### Drilling (Сверление)
- Path → Drilling
- Выберите точки сверления
- Назначьте сверло
- В MPR преобразуется в → **BohrVert** (вертикальное сверление)

#### Pocket (Карманы)
- Path → Pocket
- Выберите замкнутый контур
- Назначьте фрезу
- В MPR преобразуется в → **Pocket**

### 3. Экспорт в WoodWOP MPR

1. Выберите Job в дереве объектов
2. **Path → Post Process** (или кнопка на панели)
3. В диалоге Post Process:
   - **Post Processor:** выберите `woodwop_post`
   - **Arguments:** (опционально) например: `--precision=2`
   - **Output File:** нажмите на кнопку выбора файла

4. **ВАЖНО:** В диалоге сохранения:
   - Измените расширение с `.nc` на `.mpr`
   - Например: `my_part.nc` → `my_part.mpr`
   - Нажмите Сохранить

5. Файл `.mpr` готов!

### 4. Открытие в WoodWOP

1. Откройте WoodWOP
2. File → Open
3. Выберите сгенерированный `.mpr` файл
4. Проверьте:
   - Контуры отображаются правильно
   - Операции на своих местах
   - Размеры заготовки корректны
5. Запустите симуляцию в WoodWOP
6. Сохраните как программу для станка

## Аргументы командной строки

В поле **Arguments** можно указать:

```
--precision=2                    # Точность координат (2 знака после запятой)
--no-comments                    # Убрать комментарии из MPR
--workpiece-length=800           # Длина заготовки (мм)
--workpiece-width=600            # Ширина заготовки (мм)
--workpiece-thickness=18         # Толщина заготовки (мм)
--use-part-name                  # Назвать MPR файл по имени детали вместо документа
```

### Примеры:

**Минимальный вывод без комментариев:**
```
--no-comments --precision=2
```

**Переопределить размеры заготовки:**
```
--workpiece-length=1200 --workpiece-width=800 --workpiece-thickness=18
```

**Назвать файл по имени детали:**
```
--use-part-name
```
Например, если деталь называется "Дверь шкафа", MPR файл будет назван `Дверь_шкафа.mpr` вместо имени документа FreeCAD.

## Структура генерируемого MPR файла

```
[H                                    # Заголовок
VERSION="4.0"
OP="1"
FM="1"
CB="1"

]1                                    # Контур 1
\ Profile                             # Комментарий
$KL                                   # Линия
X="100.000"
Y="50.000"
$KA                                   # Дуга
X="150.000"
Y="100.000"
XM="125.000"                          # Центр X
YM="75.000"                           # Центр Y
R="35.355"                            # Радиус
RI="0"                                # Направление (0=CCW, 1=CW)

<100 \Werkstck\                       # Заготовка
LA="800.000"                          # Длина
BR="600.000"                          # Ширина
DI="20.000"                           # Толщина
AX="0"
AY="0"

<101 \Comment\                        # Комментарий
KM="Generated by FreeCAD WoodWOP Post Processor"
KM="Date: 2025-12-21 16:05:34"

<105 \Contourfraesen\                 # Контурное фрезерование
EA="1:0"                              # Начало контура 1, элемент 0
MDA="TAN"                             # Подход по касательной
RK="WRKL"                             # Референс слева от заготовки
EE="1:1"                              # Конец контура 1, элемент 1
MDE="TAN_AB"                          # Отход по касательной
EM="1"
RI="1"                                # Фрезеровать по часовой
TNO="1"                               # Номер инструмента
SM="0"
\Profile\                             # Название операции

!                                     # Конец файла
```

## Соответствие операций

| FreeCAD Path      | WoodWOP Macro     | ID  | Описание                    |
|-------------------|-------------------|-----|-----------------------------|
| Profile/Contour   | Contourfraesen    | 105 | Контурное фрезерование      |
| Drilling          | BohrVert          | 102 | Вертикальное сверление      |
| Pocket            | Pocket            | 107 | Фрезерование карманов       |

## Элементы контуров

| Обозначение | Тип      | Параметры              |
|-------------|----------|------------------------|
| $KL         | Линия    | X, Y (конечная точка)  |
| $KA         | Дуга     | X, Y, XM, YM, R, RI    |
| $KP         | Точка    | X, Y (пока не поддерживается) |

## Советы и рекомендации

### Подготовка в FreeCAD

1. **Используйте метрические единицы** - MPR формат использует мм
2. **Проверяйте ориентацию контуров** - важно для направления фрезерования
3. **Назначайте инструменты** - номера инструментов попадут в MPR
4. **Правильно настройте Stock** - размеры заготовки автоматически экспортируются

### Проверка перед экспортом

- ✅ Все операции имеют назначенные инструменты
- ✅ Симуляция Path показывает правильные траектории
- ✅ Размеры Stock соответствуют реальной заготовке
- ✅ Координаты операций корректны

### После экспорта

1. **Всегда проверяйте в WoodWOP** перед запуском на станке
2. **Запустите симуляцию** в WoodWOP
3. **Проверьте размеры заготовки** - особенно если переопределяли вручную
4. **Проверьте инструменты** - номера должны соответствовать вашей библиотеке

## Устранение проблем

### Контуры отображаются неправильно

**Проблема:** Контур состоит из повторяющихся элементов

**Причина:** FreeCAD генерирует несколько проходов для одного контура

**Решение:** Это нормально для многопроходной обработки. В WoodWOP можно упростить контур вручную

---

### Размеры заготовки неправильные

**Проблема:** LA, BR, DI не соответствуют реальной заготовке

**Решение 1:** Исправьте Stock в FreeCAD Job

**Решение 2:** Используйте аргументы при экспорте:
```
--workpiece-length=XXX --workpiece-width=YYY --workpiece-thickness=ZZZ
```

---

### Номера инструментов не те

**Проблема:** TNO показывает неправильный инструмент

**Решение:**
1. В FreeCAD проверьте ToolController для каждой операции
2. Убедитесь что Tool Number установлен правильно
3. Если не помогает - отредактируйте MPR файл вручную (найдите `TNO="xxx"`)

---

### FreeCAD предлагает .nc расширение

**Это нормально!** Просто измените расширение на `.mpr` при сохранении.

---

## Дополнительная информация

- **README.md** - полная документация постпроцессора
- **INSTALL_INSTRUCTIONS.md** - детальная инструкция по установке
- **mpr4x_format_us (1).txt** - спецификация формата MPR 4.0

## Обратная связь

Если вы нашли проблему или хотите предложить улучшение:
1. Проверьте что используете последнюю версию постпроцессора
2. Опишите проблему с примером (приложите FreeCAD файл и MPR)
3. Укажите версию FreeCAD и WoodWOP

---

**Версия постпроцессора:** 2.0.0
**Дата:** 2025-12-21
**Формат:** WoodWOP MPR 4.0
