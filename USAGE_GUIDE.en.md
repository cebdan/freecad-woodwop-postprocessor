# WoodWOP Post Processor Usage Guide

## Quick Start

### 1. Creating a Project in FreeCAD

1. Open FreeCAD
2. Switch to **CAM (Path) Workbench**
3. Create **Job**:
   - Path → Job → New Job
   - Select base object (part)
   - Configure Stock (workpiece) - dimensions will be automatically used in MPR

### 2. Creating Operations

Supported operations:

#### Profile (Contour Milling)
- Path → Profile
- Select faces or sketch
- Assign tool
- In MPR converts to → **Contourfraesen**

#### Drilling
- Path → Drilling
- Select drilling points
- Assign drill
- In MPR converts to → **BohrVert** (vertical drilling)

#### Pocket
- Path → Pocket
- Select closed contour
- Assign endmill
- In MPR converts to → **Pocket**

### 3. Exporting to WoodWOP MPR

1. Select Job in object tree
2. **Path → Post Process** (or button on panel)
3. In Post Process dialog:
   - **Post Processor:** select `woodwop_post`
   - **Arguments:** (optional) e.g.: `--precision=2`
   - **Output File:** click file selection button

4. **IMPORTANT:** In save dialog:
   - Change extension from `.nc` to `.mpr`
   - For example: `my_part.nc` → `my_part.mpr`
   - Click Save

5. `.mpr` file is ready!

### 4. Opening in WoodWOP

1. Open WoodWOP
2. File → Open
3. Select generated `.mpr` file
4. Verify:
   - Contours display correctly
   - Operations are in correct positions
   - Workpiece dimensions are correct
5. Run simulation in WoodWOP
6. Save as machine program

## Command Line Arguments

In the **Arguments** field you can specify:

```
--precision=2                    # Coordinate precision (2 decimal places)
--no-comments                    # Remove comments from MPR
--workpiece-length=800           # Workpiece length (mm)
--workpiece-width=600            # Workpiece width (mm)
--workpiece-thickness=18         # Workpiece thickness (mm)
--use-part-name                  # Name MPR file after part name instead of document
```

### Examples:

**Minimal output without comments:**
```
--no-comments --precision=2
```

**Override workpiece dimensions:**
```
--workpiece-length=1200 --workpiece-width=800 --workpiece-thickness=18
```

**Name file after part name:**
```
--use-part-name
```
For example, if part is named "Cabinet Door", MPR file will be named `Cabinet_Door.mpr` instead of FreeCAD document name.

## Generated MPR File Structure

```
[H                                    # Header
VERSION="4.0"
OP="1"
FM="1"
CB="1"

]1                                    # Contour 1
\ Profile                             # Comment
$KL                                   # Line
X="100.000"
Y="50.000"
$KA                                   # Arc
X="150.000"
Y="100.000"
XM="125.000"                          # Center X
YM="75.000"                           # Center Y
R="35.355"                            # Radius
RI="0"                                # Direction (0=CCW, 1=CW)

<100 \Werkstck\                       # Workpiece
LA="800.000"                          # Length
BR="600.000"                          # Width
DI="20.000"                           # Thickness
AX="0"
AY="0"

<101 \Comment\                        # Comment
KM="Generated by FreeCAD WoodWOP Post Processor"
KM="Date: 2025-12-21 16:05:34"

<105 \Contourfraesen\                 # Contour milling
EA="1:0"                              # Start contour 1, element 0
MDA="TAN"                             # Tangent approach
RK="WRKL"                             # Reference left of workpiece
EE="1:1"                              # End contour 1, element 1
MDE="TAN_AB"                          # Tangent exit
EM="1"
RI="1"                                # Mill clockwise
TNO="1"                               # Tool number
SM="0"
\Profile\                             # Operation name

!                                     # End of file
```

## Operation Mapping

| FreeCAD Path      | WoodWOP Macro     | ID  | Description                    |
|-------------------|-------------------|-----|--------------------------------|
| Profile/Contour   | Contourfraesen    | 105 | Contour milling                |
| Drilling          | BohrVert          | 102 | Vertical drilling              |
| Pocket            | Pocket            | 107 | Pocket milling                 |

## Contour Elements

| Notation | Type      | Parameters              |
|----------|-----------|-------------------------|
| $KL      | Line      | X, Y (endpoint)         |
| $KA      | Arc       | X, Y, XM, YM, R, RI     |
| $KP      | Point     | X, Y (not yet supported)|

## Tips and Recommendations

### FreeCAD Preparation

1. **Use metric units** - MPR format uses mm
2. **Check contour orientation** - important for milling direction
3. **Assign tools** - tool numbers will appear in MPR
4. **Configure Stock correctly** - workpiece dimensions are automatically exported

### Pre-Export Verification

- ✅ All operations have assigned tools
- ✅ Path simulation shows correct trajectories
- ✅ Stock dimensions match real workpiece
- ✅ Operation coordinates are correct

### After Export

1. **Always verify in WoodWOP** before running on machine
2. **Run simulation** in WoodWOP
3. **Check workpiece dimensions** - especially if manually overridden
4. **Check tools** - numbers should match your library

## Troubleshooting

### Contours display incorrectly

**Problem:** Contour consists of repeating elements

**Cause:** FreeCAD generates multiple passes for one contour

**Solution:** This is normal for multi-pass machining. In WoodWOP you can simplify contour manually

---

### Workpiece dimensions are incorrect

**Problem:** LA, BR, DI don't match real workpiece

**Solution 1:** Fix Stock in FreeCAD Job

**Solution 2:** Use arguments when exporting:
```
--workpiece-length=XXX --workpiece-width=YYY --workpiece-thickness=ZZZ
```

---

### Tool numbers are wrong

**Problem:** TNO shows incorrect tool

**Solution:**
1. In FreeCAD check ToolController for each operation
2. Ensure Tool Number is set correctly
3. If that doesn't help - edit MPR file manually (find `TNO="xxx"`)

---

### FreeCAD suggests .nc extension

**This is normal!** Just change extension to `.mpr` when saving.

---

## Additional Information

- **README.en.md** - full post-processor documentation
- **INSTALL_INSTRUCTIONS.en.md** - detailed installation instructions
- **mpr4x_format_us (1).txt** - MPR 4.0 format specification

## Feedback

If you found an issue or want to suggest improvement:
1. Check that you're using latest post-processor version
2. Describe the problem with example (attach FreeCAD file and MPR)
3. Specify FreeCAD and WoodWOP versions

---

**Post-processor version:** 2.0.0
**Date:** 2025-12-21
**Format:** WoodWOP MPR 4.0

