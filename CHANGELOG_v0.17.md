# Отчёт о версии v0.17

## Дата: 2025-01-28

## Основные изменения

### Реализация ключа `/p_c` для экспорта Path Commands

**Описание:**
Добавлен новый ключ `/p_c` (или `/p-c`, `--p_c`, `--p-c`), который включает экспорт всех команд пути (Path Commands) из всех операций в текстовый файл для отладки и анализа.

**Проблема:**
Ранее не было возможности экспортировать все команды пути из операций FreeCAD для анализа и отладки пост-процессора.

**Решение:**
1. **Добавлен глобальный флаг `ENABLE_PATH_COMMANDS_EXPORT`**:
   - По умолчанию `False`
   - Устанавливается в `True` при указании ключа `/p_c`

2. **Создана функция `export_path_commands(objectslist, output_filename)`**:
   - Обрабатывает все операции из `objectslist`
   - Извлекает все команды пути из каждой операции
   - Форматирует и записывает их в текстовый файл
   - Возвращает `True` при успешном создании файла

3. **Интеграция в `Command.py`**:
   - Проверка флага `ENABLE_PATH_COMMANDS_EXPORT` после создания основных файлов
   - Получение списка операций из Job
   - Вызов `export_path_commands()` если флаг установлен
   - Создание файла `{имя_детали}_path_commands.txt`

4. **Обновлено всплывающее окно**:
   - Добавлен параметр `path_commands_filename` в функцию `_show_success_dialog`
   - Добавлена секция "Path Commands" в диалог с информацией о созданном файле
   - Файл отображается с размером в KB

## Технические детали

### Изменённые файлы:
- `woodwop post/woodwop_post.py` - добавлен флаг, парсинг ключа, функция экспорта
- `src/Mod/CAM/Path/Post/Command.py` - интеграция создания файла и обновление диалога
- `.pixi/envs/default/Mod/CAM/Path/Post/Command.py` - синхронизация
- `src/Mod/CAM/Path/Post/scripts/woodwop_post.py` - синхронизация

### Формат файла Path Commands:
```
================================================================================
FreeCAD Path Commands Export
================================================================================
Generated: 2025-01-28 01:33:30
Post Processor: WoodWOP MPR

--------------------------------------------------------------------------------
Operation: Profile_001
Type: profile
Tool: 101
--------------------------------------------------------------------------------

   1. G0 X0.000 Y0.000 Z10.000
   2. G1 X100.000 Y0.000 Z-5.000
   3. G1 X100.000 Y50.000 Z-5.000
   ...

Total commands in this operation: 25

================================================================================
Summary
================================================================================
Total operations: 3
Total commands: 87

================================================================================
End of Export
================================================================================
```

### Добавленные функции:
- `export_path_commands(objectslist, output_filename)` - экспорт команд пути в файл

### Обновлённые функции:
- `_show_success_dialog()` - добавлен параметр `path_commands_filename` и секция отображения

## Поведение ключа `/p_c`

### Без ключа `/p_c`:
- Файл Path Commands не создаётся
- `ENABLE_PATH_COMMANDS_EXPORT = False`
- В диалоге не отображается информация о файле

### С ключом `/p_c`:
- Создаётся файл `{имя_детали}_path_commands.txt`
- `ENABLE_PATH_COMMANDS_EXPORT = True`
- Файл содержит все команды пути из всех операций
- В диалоге отображается информация о созданном файле

## Примеры использования

### Базовое использование:
```
/p_c
```
Создаёт только файл Path Commands.

### Комбинированное использование:
```
/p_c /nc /log /report
```
Создаёт:
- MPR файл
- NC файл
- Лог-файл
- Отчёт о Job
- Файл Path Commands

## Важные замечания

1. **Перезагрузка FreeCAD обязательна** после изменений в `woodwop_post.py` и `Command.py`, так как FreeCAD кеширует модули Python.

2. **Файл создаётся после подтверждения** имени файла в диалоге сохранения, как и другие дополнительные файлы (отчёт, лог).

3. **Формат файла** - текстовый, UTF-8, с переносами строк в стиле Unix (`\n`).

4. **Имя файла** формируется автоматически на основе имени детали/Job: `{имя_детали}_path_commands.txt`

## Тестирование

Проверено:
- ✅ Ключ `/p_c` корректно включает/выключает экспорт Path Commands
- ✅ Файл создаётся только при указании ключа
- ✅ Файл содержит все команды из всех операций
- ✅ Информация о файле отображается в диалоге
- ✅ Все версии файлов синхронизированы

## Следующие шаги

- Возможно, стоит добавить фильтрацию команд (например, только G-коды движения)
- Рассмотреть возможность добавления визуализации траектории в файле
- Добавить опцию группировки команд по операциям с более детальной информацией

